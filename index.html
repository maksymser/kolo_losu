<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Diagnostyczny Canvas</title>
    <link href='https://fonts.googleapis.com/css?family=Boldonse&display=swap' rel='stylesheet'>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-case {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        canvas {
            border: 1px solid #000;
            background: #fff;
        }
        .buttons {
            margin-top: 10px;
        }
        .buttons button {
            padding: 8px 12px;
            margin-right: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        #generate-report {
            background: #007bff;
            color: white;
            padding: 15px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        #report-container {
            margin-top: 20px;
        }
        textarea {
            width: 100%;
            box-sizing: border-box;
            font-family: monospace;
        }
    </style>
</head>
<body>

    <h1>Test Diagnostyczny Środowiska Canvas</h1>
    <p>Wykonaj każdy test i odpowiedz "Tak" lub "Nie". Na końcu wygeneruj raport.</p>

    <div class="test-case">
        <h3>Test 1: Proste wypełnienie (fillRect)</h3>
        <p>Czy widzisz duży, zielony kwadrat?</p>
        <canvas id="test1" width="150" height="150"></canvas>
        <div class="buttons">
            <button onclick="recordResult('test1_simple_fill', 'Tak', this)">Tak</button>
            <button onclick="recordResult('test1_simple_fill', 'Nie', this)">Nie</button>
        </div>
    </div>

    <div class="test-case">
        <h3>Test 2: Proste obramowanie (strokeRect)</h3>
        <p>Czy widzisz niebieską ramkę kwadratu?</p>
        <canvas id="test2" width="150" height="150"></canvas>
        <div class="buttons">
            <button onclick="recordResult('test2_simple_stroke', 'Tak', this)">Tak</button>
            <button onclick="recordResult('test2_simple_stroke', 'Nie', this)">Nie</button>
        </div>
    </div>

    <div class="test-case">
        <h3>Test 3: Gradient Liniowy (createLinearGradient)</h3>
        <p>Czy widzisz kwadrat z płynnym przejściem od czerwonego do białego?</p>
        <canvas id="test3" width="150" height="150"></canvas>
        <div class="buttons">
            <button onclick="recordResult('test3_gradient', 'Tak', this)">Tak</button>
            <button onclick="recordResult('test3_gradient', 'Nie', this)">Nie</button>
        </div>
    </div>

    <div class="test-case">
        <h3>Test 4: Cienie (shadowBlur)</h3>
        <p>Czy widzisz pomarańczowy kwadrat z widocznym czarnym cieniem?</p>
        <canvas id="test4" width="150" height="150"></canvas>
        <div class="buttons">
            <button onclick="recordResult('test4_shadow', 'Tak', this)">Tak</button>
            <button onclick="recordResult('test4_shadow', 'Nie', this)">Nie</button>
        </div>
    </div>

    <div class="test-case">
        <h3>Test 5: Rysowanie Tekstu (Bezpieczna czcionka)</h3>
        <p>Czy widzisz czarny napis "Test Arial" na białym tle?</p>
        <canvas id="test5" width="150" height="150"></canvas>
        <div class="buttons">
            <button onclick="recordResult('test5_text_arial', 'Tak', this)">Tak</button>
            <button onclick="recordResult('test5_text_arial', 'Nie', this)">Nie</button>
        </div>
    </div>

    <div class="test-case">
        <h3>Test 6: Rysowanie Tekstu (Czcionka Webowa)</h3>
        <p>Czy widzisz czarny napis "Test Boldonse" (tą samą czcionką co "KOŁO LOSU")?</p>
        <canvas id="test6" width="150" height="150"></canvas>
        <div class="buttons">
            <button onclick="recordResult('test6_text_boldonse', 'Tak', this)">Tak</button>
            <button onclick="recordResult('test6_text_boldonse', 'Nie', this)">Nie</button>
        </div>
    </div>

    <div class="test-case">
        <h3>Test 7: Rysowanie Płótna na Płótnie (drawImage)</h3>
        <p>Czy widzisz mały, czerwony kwadrat w rogu tego płótna?</p>
        <canvas id="test7" width="150" height="150"></canvas>
        <div class="buttons">
            <button onclick="recordResult('test7_drawImage', 'Tak', this)">Tak</button>
            <button onclick="recordResult('test7_drawImage', 'Nie', this)">Nie</button>
        </div>
    </div>

    <button id="generate-report" onclick="generateReport()">Wygeneruj Raport Diagnostyczny</button>

    <div id="report-container" style="display:none;">
        <h2>Raport Diagnostyczny</h2>
        <p>Skopiuj i wklej cały poniższy tekst w odpowiedzi do mnie:</p>
        <textarea id="report-output" rows="20" readonly></textarea>
    </div>

    <script>
        // Obiekt do przechowywania logów
        let log = {
            test1_simple_fill: 'Nie testowano',
            test2_simple_stroke: 'Nie testowano',
            test3_gradient: 'Nie testowano',
            test4_shadow: 'Nie testowano',
            test5_text_arial: 'Nie testowano',
            test6_text_boldonse: 'Nie testowano',
            test7_drawImage: 'Nie testowano',
            auto_fillText_arial: 'Nie uruchomiono',
            auto_fillText_boldonse: 'Nie uruchomiono',
            auto_toDataURL: 'Nie uruchomiono',
            userAgent: navigator.userAgent
        };

        // Funkcja do zapisu wyników
        function recordResult(testId, status, button) {
            log[testId] = status;
            
            // Wizualna informacja zwrotna
            let parent = button.parentElement;
            parent.querySelectorAll('button').forEach(b => b.style.border = 'none');
            button.style.border = (status === 'Tak') ? '3px solid green' : '3px solid red';

            let canvas = parent.previousElementSibling;
            canvas.style.borderColor = (status === 'Tak') ? 'green' : 'red';
        }

        // Test 1: Proste wypełnienie
        function runTest1() {
            try {
                let ctx = document.getElementById('test1').getContext('2d');
                ctx.fillStyle = 'green';
                ctx.fillRect(10, 10, 130, 130);
            } catch (e) { log.test1_simple_fill = 'BŁĄD: ' + e.message; }
        }

        // Test 2: Proste obramowanie
        function runTest2() {
            try {
                let ctx = document.getElementById('test2').getContext('2d');
                ctx.strokeStyle = 'blue';
                ctx.lineWidth = 5;
                ctx.strokeRect(10, 10, 130, 130);
            } catch (e) { log.test2_simple_stroke = 'BŁĄD: ' + e.message; }
        }

        // Test 3: Gradient Liniowy
        function runTest3() {
            try {
                let ctx = document.getElementById('test3').getContext('2d');
                let grad = ctx.createLinearGradient(0, 0, 150, 0);
                grad.addColorStop(0, 'red');
                grad.addColorStop(1, 'white');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, 150, 150);
            } catch (e) { log.test3_gradient = 'BŁĄD: ' + e.message; }
        }

        // Test 4: Cienie
        function runTest4() {
            try {
                let ctx = document.getElementById('test4').getContext('2d');
                ctx.shadowColor = '#000000';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 5;
                ctx.shadowOffsetY = 5;
                ctx.fillStyle = 'orange';
                ctx.fillRect(20, 20, 100, 100);
            } catch (e) { log.test4_shadow = 'BŁĄD: ' + e.message; }
        }

        // Test 5: Rysowanie Tekstu (Arial)
        function runTest5() {
            try {
                let ctx = document.getElementById('test5').getContext('2d');
                ctx.font = '30px Arial';
                ctx.fillStyle = 'black';
                ctx.fillText('Test Arial', 10, 50);
            } catch (e) { log.test5_text_arial = 'BŁĄD: ' + e.message; }
        }

        // Test 6: Rysowanie Tekstu (Boldonse)
        function runTest6() {
            try {
                let ctx = document.getElementById('test6').getContext('2d');
                ctx.font = '30px Boldonse';
                ctx.fillStyle = 'black';
                ctx.fillText('Test Boldonse', 10, 50);
            } catch (e) { log.test6_text_boldonse = 'BŁĄD: ' + e.message; }
        }

        // Test 7: Rysowanie Canvas na Canvasie
        function runTest7() {
            try {
                // 1. Stwórz płótno w pamięci (off-screen)
                let offScreenCanvas = document.createElement('canvas');
                offScreenCanvas.width = 50;
                offScreenCanvas.height = 50;
                let offCtx = offScreenCanvas.getContext('2d');
                offCtx.fillStyle = 'red';
                offCtx.fillRect(0, 0, 50, 50);

                // 2. Narysuj płótno z pamięci na widocznym płótnie
                let mainCtx = document.getElementById('test7').getContext('2d');
                mainCtx.drawImage(offScreenCanvas, 10, 10);
            } catch (e) { log.test7_drawImage = 'BŁĄD: ' + e.message; }
        }

        // Generowanie raportu
        function generateReport() {
            // Dodatkowe testy automatyczne
            try {
                const testCtx = document.createElement('canvas').getContext('2d');
                testCtx.font = '30px Arial';
                testCtx.fillText('test', 0, 0);
                log.auto_fillText_arial = 'Sukces';
            } catch(e) {
                log.auto_fillText_arial = 'BŁĄD: ' + e.message;
            }
            
            try {
                const testCtx = document.createElement('canvas').getContext('2d');
                testCtx.font = '30px Boldonse'; // Wymaga załadowania czcionki
                testCtx.fillText('test', 0, 0);
                log.auto_fillText_boldonse = 'Sukces';
            } catch(e) {
                log.auto_fillText_boldonse = 'BŁĄD: ' + e.message;
            }
            
            try {
                const testCanvas = document.createElement('canvas');
                testCanvas.getContext('2d').fillRect(0,0,1,1);
                testCanvas.toDataURL();
                log.auto_toDataURL = 'Sukces';
            } catch(e) {
                log.auto_toDataURL = 'BŁĄD: ' + e.message;
            }

            // Formatowanie wyjścia
            let output = "--- RAPORT DIAGNOSTYCZNY CANVAS ---\n\n";
            output += "Agent Użytkownika (Przeglądarka):\n" + log.userAgent + "\n\n";
            output += "Testy Manualne (Tak/Nie):\n";
            output += `  1. Proste wypełnienie: ${log.test1_simple_fill}\n`;
            output += `  2. Proste obramowanie: ${log.test2_simple_stroke}\n`;
            output += `  3. Gradient Liniowy: ${log.test3_gradient}\n`;
            output += `  4. Cienie: ${log.test4_shadow}\n`;
            output += `  5. Tekst (Arial): ${log.test5_text_arial}\n`;
            output += `  6. Tekst (Boldonse): ${log.test6_text_boldonse}\n`;
            output += `  7. Płótno na płótnie (drawImage): ${log.test7_drawImage}\n`;
            
            output += "\nTesty Automatyczne (Techniczne):\n";
            output += `  - Wypełnienie tekstem (Arial): ${log.auto_fillText_arial}\n`;
            output += `  - Wypełnienie tekstem (Boldonse): ${log.auto_fillText_boldonse}\n`;
            output += `  - Eksport do DataURL: ${log.auto_toDataURL}\n`;
            output += "------------------------------------";
            
            document.getElementById('report-output').value = output;
            document.getElementById('report-container').style.display = 'block';
            document.getElementById('generate-report').style.display = 'none';
        }

        // Uruchomienie testów po załadowaniu strony
        window.onload = () => {
            runTest1();
            runTest2();
            runTest3();
            runTest4();
            
            // Czekamy chwilę na załadowanie czcionki Google
            setTimeout(() => {
                runTest5();
                runTest6();
            }, 1000); 
            
            runTest7();
        };
    </script>

</body>
</html>
